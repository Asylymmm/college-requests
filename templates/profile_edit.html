{% extends "base.html" %}
{% block title %}Редактирование профиля{% endblock %}
{% block content %}

<div class="container py-4" style="max-width: 980px;">
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-4">
    <div>
      <div class="text-white-50 small">Профиль</div>
      <h2 class="text-white m-0">Редактирование</h2>
    </div>
    <a class="btn btn-glass" href="{{ url_for('profile_view') }}">
      <i class="bi bi-arrow-left"></i> Назад
    </a>
  </div>

  <div class="card card-premium">
    <div class="card-body p-4 p-md-5">
      <form method="post" enctype="multipart/form-data">

        <div class="row g-3">

          <div class="col-md-6">
            <label class="form-label">ФИО</label>
            <input class="form-control" name="full_name" value="{{ u['full_name'] }}" required>
          </div>

          <!-- username (можно выбрать 1 раз) -->
          <div class="col-md-3">
            <label class="form-label">Имя пользователя</label>
            <input
              class="form-control"
              name="username"
              value="{{ u['username'] if u['username'] else '' }}"
              placeholder="например: suleymenovv"
              {% if username_locked %}disabled{% endif %}
            >
            <div class="form-text">
              {% if username_locked %}
                Имя уже задано и не меняется.
              {% else %}
                3–20 символов: a-z, 0-9, _
              {% endif %}
            </div>
          </div>

          <!-- birth_date (день/месяц/год) -->
          <div class="col-md-3">
            <label class="form-label">Дата рождения</label>
            <input
              class="form-control"
              name="birth_date"
              type="date"
              value="{{ u['birth_date'] if u['birth_date'] else '' }}"
            >
            <div class="form-text">
              Сейчас: {% if age is not none %}{{ age }} лет{% else %}—{% endif %}
            </div>
          </div>

          <!-- Группа только для student -->
          {% if u['role'] == 'student' %}
          <div class="col-md-6">
            <label class="form-label">Группа</label>
            <select class="form-select" name="group_name" {% if group_locked %}disabled{% endif %}>
              <option value="">—</option>
              {% for g in allowed_groups %}
                <option value="{{ g }}" {% if u['group_name']==g %}selected{% endif %}>{{ g }}</option>
              {% endfor %}
            </select>
            <div class="form-text">
              {% if group_locked %}
                Группа уже выбрана и больше не меняется.
              {% else %}
                Можно выбрать только один раз.
              {% endif %}
            </div>
          </div>
          {% endif %}

        </div>

        <hr class="my-4">

        <div class="row g-3 align-items-center">
          <div class="col-md-6">
            <label class="form-label">Аватар (png/jpg/webp до 2MB)</label>
            <input class="form-control" type="file" name="avatar" accept=".png,.jpg,.jpeg,.webp">
          </div>

          <div class="col-md-6">
            <label class="form-label">Текущий аватар</label><br>
            <img
              src="{{ url_for('static', filename=u['avatar']) if u['avatar'] else url_for('static', filename='avatar-default.png') }}"
              style="width:64px;height:64px;border-radius:50%;object-fit:cover;"
              alt="avatar">
          </div>
        </div>

        <div class="mt-4">
          <label class="form-label">Описание</label>
          <textarea class="form-control" name="bio" rows="4" placeholder="Коротко о себе...">{{ u['bio'] if u['bio'] else '' }}</textarea>
        </div>

        <div class="d-flex gap-2 mt-4">
          <button class="btn btn-primary">
            <i class="bi bi-check2-circle"></i> Сохранить
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

{% endblock %}